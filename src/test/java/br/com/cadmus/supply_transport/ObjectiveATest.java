package br.com.cadmus.supply_transport;

import io.restassured.RestAssured;
import io.restassured.http.ContentType;
import org.junit.Before;
import org.junit.Test;
import org.springframework.http.HttpStatus;

import static io.restassured.RestAssured.given;
import static org.hamcrest.Matchers.*;

public class ObjectiveATest extends IntegrationTestConfiguration {

    @Override
    @Before
    public void setUp() {
        super.setUp();
        RestAssured.basePath = "/trips";
    }

    @Test
    public void listing_MissingDestinyStationParameter_ReturningException() {
        given()
                .queryParam("destinyStation", "CGH")
                .queryParam("tripDate", "")
                .contentType(ContentType.JSON)
                .when()
                .get()
                .then()
                .statusCode(HttpStatus.BAD_REQUEST.value());
    }

    @Test
    public void listing_MissingOriginStationParameter_ReturningException() {
        given()
                .queryParam("originStation", "PMW")
                .queryParam("tripDate", "")
                .contentType(ContentType.JSON)
                .when()
                .get()
                .then()
                .statusCode(HttpStatus.BAD_REQUEST.value());
    }

    @Test
    public void listing_ConnectionWithDate_ReturningFiltered() {
        given()
                .queryParam("originStation", "BSB")
                .queryParam("destinyStation", "FLN")
                .queryParam("tripDate", "2021-02-10")
                .contentType(ContentType.JSON)
                .when()
                .get()
                .then()
                .body("size()", is(3))
                .body("$", everyItem(hasKey("origin")))
                .body("$", everyItem(hasKey("destiny")))
                .body("$", everyItem(hasKey("departure")))
                .body("$", everyItem(hasKey("arrival")))
                .body("$", everyItem(hasKey("steps")))
                .body("$.steps", everyItem(hasKey("origin")))
                .body("$.steps", everyItem(hasKey("destiny")))
                .body("$.steps", everyItem(hasKey("departure")))
                .body("$.steps", everyItem(hasKey("arrival")))
                .body("$.steps", everyItem(hasKey("company")))
                .body("$.steps", everyItem(hasKey("price")))
                .body("[0].origin", is("BSB"))
                .body("[0].destiny", is("FLN"))
                .body("[0].departure", is("2021-02-10T09:00:00"))
                .body("[0].arrival", is("2021-02-10T19:20:00"))
                .body("[0].steps[0].origin", is("BSB"))
                .body("[0].steps[0].destiny", is("FLN"))
                .body("[0].steps[0].departure", is("2021-02-10T09:00:00"))
                .body("[0].steps[0].arrival", is("2021-02-10T19:20:00"))
                .body("[0].steps[0].company", is("UberOnRails"))
                .body("[0].steps[0].price", is(1347.21f))
                .body("[1].origin", is("BSB"))
                .body("[1].destiny", is("FLN"))
                .body("[1].departure", is("2021-02-10T19:00:00"))
                .body("[1].arrival", is("2021-02-10T23:30:00"))
                .body("[1].steps[0].origin", is("BSB"))
                .body("[1].steps[0].destiny", is("FLN"))
                .body("[1].steps[0].departure", is("2021-02-10T19:00:00"))
                .body("[1].steps[0].arrival", is("2021-02-10T23:30:00"))
                .body("[1].steps[0].company", is("iTrain"))
                .body("[1].steps[0].price", is(369.19f))
                .body("[2].origin", is("BSB"))
                .body("[2].destiny", is("FLN"))
                .body("[2].departure", is("2021-02-10T06:40:00"))
                .body("[2].arrival", is("2021-02-11T16:20:00"))
                .body("[2].steps[0].origin", is("BSB"))
                .body("[2].steps[0].destiny", is("VCP"))
                .body("[2].steps[0].departure", is("2021-02-10T06:40:00"))
                .body("[2].steps[0].arrival", is("2021-02-10T19:40:00"))
                .body("[2].steps[0].company", is("UberOnRails"))
                .body("[2].steps[0].price", is(948.46f))
                .body("[2].steps[1].origin", is("VCP"))
                .body("[2].steps[1].destiny", is("FLN"))
                .body("[2].steps[1].departure", is("2021-02-11T07:40:00"))
                .body("[2].steps[1].arrival", is("2021-02-11T16:20:00"))
                .body("[2].steps[1].company", is("UberOnRails"))
                .body("[2].steps[1].price", is(1192.39f))
                .statusCode(HttpStatus.OK.value());
    }

    @Test
    public void listing_ConnectionWithNoDate_ReturningFiltered() {
        given()
                .queryParam("originStation", "PMW")
                .queryParam("destinyStation", "CGH")
                .queryParam("tripDate", "")
                .contentType(ContentType.JSON)
                .when()
                .get()
                .then()
                .body("size()", is(14))
                .body("$", everyItem(hasKey("origin")))
                .body("$", everyItem(hasKey("destiny")))
                .body("$", everyItem(hasKey("departure")))
                .body("$", everyItem(hasKey("arrival")))
                .body("$", everyItem(hasKey("steps")))
                .body("$.steps", everyItem(hasKey("origin")))
                .body("$.steps", everyItem(hasKey("destiny")))
                .body("$.steps", everyItem(hasKey("departure")))
                .body("$.steps", everyItem(hasKey("arrival")))
                .body("$.steps", everyItem(hasKey("company")))
                .body("$.steps", everyItem(hasKey("price")))
                .body("[0].origin", is("PMW"))
                .body("[0].destiny", is("CGH"))
                .body("[0].departure", is("2021-02-10T09:40:00"))
                .body("[0].arrival", is("2021-02-10T19:40:00"))
                .body("[0].steps[0].origin", is("PMW"))
                .body("[0].steps[0].destiny", is("CGH"))
                .body("[0].steps[0].departure", is("2021-02-10T09:40:00"))
                .body("[0].steps[0].arrival", is("2021-02-10T19:40:00"))
                .body("[0].steps[0].company", is("UberOnRails"))
                .body("[0].steps[0].price", is(1199.58f))
                .body("[1].origin", is("PMW"))
                .body("[1].destiny", is("CGH"))
                .body("[1].departure", is("2021-02-10T09:00:00"))
                .body("[1].arrival", is("2021-02-10T23:30:00"))
                .body("[1].steps[0].origin", is("PMW"))
                .body("[1].steps[0].destiny", is("BEL"))
                .body("[1].steps[0].departure", is("2021-02-10T09:00:00"))
                .body("[1].steps[0].arrival", is("2021-02-10T10:00:00"))
                .body("[1].steps[0].company", is("iTrain"))
                .body("[1].steps[0].price", is(139.25f))
                .body("[1].steps[1].origin", is("BEL"))
                .body("[1].steps[1].destiny", is("CGH"))
                .body("[1].steps[1].departure", is("2021-02-10T11:30:00"))
                .body("[1].steps[1].arrival", is("2021-02-10T23:30:00"))
                .body("[1].steps[1].company", is("iTrain"))
                .body("[1].steps[1].price", is(1094.5f))
                .body("[2].origin", is("PMW"))
                .body("[2].destiny", is("CGH"))
                .body("[2].departure", is("2021-02-10T10:00:00"))
                .body("[2].arrival", is("2021-02-11T15:00:00"))
                .body("[2].steps[0].origin", is("PMW"))
                .body("[2].steps[0].destiny", is("FLN"))
                .body("[2].steps[0].departure", is("2021-02-10T10:00:00"))
                .body("[2].steps[0].arrival", is("2021-02-10T21:20:00"))
                .body("[2].steps[0].company", is("UberOnRails"))
                .body("[2].steps[0].price", is(997.81f))
                .body("[2].steps[1].origin", is("FLN"))
                .body("[2].steps[1].destiny", is("CGH"))
                .body("[2].steps[1].departure", is("2021-02-11T06:40:00"))
                .body("[2].steps[1].arrival", is("2021-02-11T15:00:00"))
                .body("[2].steps[1].company", is("UberOnRails"))
                .body("[2].steps[1].price", is(1130.9f))
                .body("[3].origin", is("PMW"))
                .body("[3].destiny", is("CGH"))
                .body("[3].departure", is("2021-02-11T09:40:00"))
                .body("[3].arrival", is("2021-02-11T19:40:00"))
                .body("[3].steps[0].origin", is("PMW"))
                .body("[3].steps[0].destiny", is("CGH"))
                .body("[3].steps[0].departure", is("2021-02-11T09:40:00"))
                .body("[3].steps[0].arrival", is("2021-02-11T19:40:00"))
                .body("[3].steps[0].company", is("UberOnRails"))
                .body("[3].steps[0].price", is(1199.58f))
                .body("[4].origin", is("PMW"))
                .body("[4].destiny", is("CGH"))
                .body("[4].departure", is("2021-02-12T09:40:00"))
                .body("[4].arrival", is("2021-02-12T19:40:00"))
                .body("[4].steps[0].origin", is("PMW"))
                .body("[4].steps[0].destiny", is("CGH"))
                .body("[4].steps[0].departure", is("2021-02-12T09:40:00"))
                .body("[4].steps[0].arrival", is("2021-02-12T19:40:00"))
                .body("[4].steps[0].company", is("UberOnRails"))
                .body("[4].steps[0].price", is(1199.58f))
                .body("[5].origin", is("PMW"))
                .body("[5].destiny", is("CGH"))
                .body("[5].departure", is("2021-02-12T09:00:00"))
                .body("[5].arrival", is("2021-02-12T23:30:00"))
                .body("[5].steps[0].origin", is("PMW"))
                .body("[5].steps[0].destiny", is("BEL"))
                .body("[5].steps[0].departure", is("2021-02-12T09:00:00"))
                .body("[5].steps[0].arrival", is("2021-02-12T10:00:00"))
                .body("[5].steps[0].company", is("iTrain"))
                .body("[5].steps[0].price", is(139.25f))
                .body("[5].steps[1].origin", is("BEL"))
                .body("[5].steps[1].destiny", is("CGH"))
                .body("[5].steps[1].departure", is("2021-02-12T11:30:00"))
                .body("[5].steps[1].arrival", is("2021-02-12T23:30:00"))
                .body("[5].steps[1].company", is("iTrain"))
                .body("[5].steps[1].price", is(1094.5f))
                .body("[6].origin", is("PMW"))
                .body("[6].destiny", is("CGH"))
                .body("[6].departure", is("2021-02-12T10:00:00"))
                .body("[6].arrival", is("2021-02-13T15:00:00"))
                .body("[6].steps[0].origin", is("PMW"))
                .body("[6].steps[0].destiny", is("FLN"))
                .body("[6].steps[0].departure", is("2021-02-12T10:00:00"))
                .body("[6].steps[0].arrival", is("2021-02-12T21:20:00"))
                .body("[6].steps[0].company", is("UberOnRails"))
                .body("[6].steps[0].price", is(997.81f))
                .body("[6].steps[1].origin", is("FLN"))
                .body("[6].steps[1].destiny", is("CGH"))
                .body("[6].steps[1].departure", is("2021-02-13T06:40:00"))
                .body("[6].steps[1].arrival", is("2021-02-13T15:00:00"))
                .body("[6].steps[1].company", is("UberOnRails"))
                .body("[6].steps[1].price", is(1130.9f))
                .body("[7].origin", is("PMW"))
                .body("[7].destiny", is("CGH"))
                .body("[7].departure", is("2021-02-13T09:00:00"))
                .body("[7].arrival", is("2021-02-13T23:30:00"))
                .body("[7].steps[0].origin", is("PMW"))
                .body("[7].steps[0].destiny", is("BEL"))
                .body("[7].steps[0].departure", is("2021-02-13T09:00:00"))
                .body("[7].steps[0].arrival", is("2021-02-13T10:00:00"))
                .body("[7].steps[0].company", is("iTrain"))
                .body("[7].steps[0].price", is(139.25f))
                .body("[7].steps[1].origin", is("BEL"))
                .body("[7].steps[1].destiny", is("CGH"))
                .body("[7].steps[1].departure", is("2021-02-13T11:30:00"))
                .body("[7].steps[1].arrival", is("2021-02-13T23:30:00"))
                .body("[7].steps[1].company", is("iTrain"))
                .body("[7].steps[1].price", is(1094.5f))
                .body("[8].origin", is("PMW"))
                .body("[8].destiny", is("CGH"))
                .body("[8].departure", is("2021-02-13T10:00:00"))
                .body("[8].arrival", is("2021-02-14T15:00:00"))
                .body("[8].steps[0].origin", is("PMW"))
                .body("[8].steps[0].destiny", is("FLN"))
                .body("[8].steps[0].departure", is("2021-02-13T10:00:00"))
                .body("[8].steps[0].arrival", is("2021-02-13T21:20:00"))
                .body("[8].steps[0].company", is("UberOnRails"))
                .body("[8].steps[0].price", is(997.81f))
                .body("[8].steps[1].origin", is("FLN"))
                .body("[8].steps[1].destiny", is("CGH"))
                .body("[8].steps[1].departure", is("2021-02-14T06:40:00"))
                .body("[8].steps[1].arrival", is("2021-02-14T15:00:00"))
                .body("[8].steps[1].company", is("UberOnRails"))
                .body("[8].steps[1].price", is(1130.9f))
                .body("[9].origin", is("PMW"))
                .body("[9].destiny", is("CGH"))
                .body("[9].departure", is("2021-02-15T09:00:00"))
                .body("[9].arrival", is("2021-02-15T23:30:00"))
                .body("[9].steps[0].origin", is("PMW"))
                .body("[9].steps[0].destiny", is("BEL"))
                .body("[9].steps[0].departure", is("2021-02-15T09:00:00"))
                .body("[9].steps[0].arrival", is("2021-02-15T10:00:00"))
                .body("[9].steps[0].company", is("iTrain"))
                .body("[9].steps[0].price", is(139.25f))
                .body("[9].steps[1].origin", is("BEL"))
                .body("[9].steps[1].destiny", is("CGH"))
                .body("[9].steps[1].departure", is("2021-02-15T11:30:00"))
                .body("[9].steps[1].arrival", is("2021-02-15T23:30:00"))
                .body("[9].steps[1].company", is("iTrain"))
                .body("[9].steps[1].price", is(1094.5f))
                .body("[10].origin", is("PMW"))
                .body("[10].destiny", is("CGH"))
                .body("[10].departure", is("2021-02-16T09:00:00"))
                .body("[10].arrival", is("2021-02-16T23:30:00"))
                .body("[10].steps[0].origin", is("PMW"))
                .body("[10].steps[0].destiny", is("BEL"))
                .body("[10].steps[0].departure", is("2021-02-16T09:00:00"))
                .body("[10].steps[0].arrival", is("2021-02-16T10:00:00"))
                .body("[10].steps[0].company", is("iTrain"))
                .body("[10].steps[0].price", is(139.25f))
                .body("[10].steps[1].origin", is("BEL"))
                .body("[10].steps[1].destiny", is("CGH"))
                .body("[10].steps[1].departure", is("2021-02-16T11:30:00"))
                .body("[10].steps[1].arrival", is("2021-02-16T23:30:00"))
                .body("[10].steps[1].company", is("iTrain"))
                .body("[10].steps[1].price", is(1094.5f))
                .body("[11].origin", is("PMW"))
                .body("[11].destiny", is("CGH"))
                .body("[11].departure", is("2021-02-16T10:00:00"))
                .body("[11].arrival", is("2021-02-17T15:00:00"))
                .body("[11].steps[0].origin", is("PMW"))
                .body("[11].steps[0].destiny", is("FLN"))
                .body("[11].steps[0].departure", is("2021-02-16T10:00:00"))
                .body("[11].steps[0].arrival", is("2021-02-16T21:20:00"))
                .body("[11].steps[0].company", is("UberOnRails"))
                .body("[11].steps[0].price", is(997.81f))
                .body("[11].steps[1].origin", is("FLN"))
                .body("[11].steps[1].destiny", is("CGH"))
                .body("[11].steps[1].departure", is("2021-02-17T06:40:00"))
                .body("[11].steps[1].arrival", is("2021-02-17T15:00:00"))
                .body("[11].steps[1].company", is("UberOnRails"))
                .body("[11].steps[1].price", is(1130.9f))
                .body("[12].origin", is("PMW"))
                .body("[12].destiny", is("CGH"))
                .body("[12].departure", is("2021-02-17T09:40:00"))
                .body("[12].arrival", is("2021-02-17T19:40:00"))
                .body("[12].steps[0].origin", is("PMW"))
                .body("[12].steps[0].destiny", is("CGH"))
                .body("[12].steps[0].departure", is("2021-02-17T09:40:00"))
                .body("[12].steps[0].arrival", is("2021-02-17T19:40:00"))
                .body("[12].steps[0].company", is("UberOnRails"))
                .body("[12].steps[0].price", is(1199.58f))
                .body("[13].origin", is("PMW"))
                .body("[13].destiny", is("CGH"))
                .body("[13].departure", is("2021-02-17T09:00:00"))
                .body("[13].arrival", is("2021-02-17T23:30:00"))
                .body("[13].steps[0].origin", is("PMW"))
                .body("[13].steps[0].destiny", is("BEL"))
                .body("[13].steps[0].departure", is("2021-02-17T09:00:00"))
                .body("[13].steps[0].arrival", is("2021-02-17T10:00:00"))
                .body("[13].steps[0].company", is("iTrain"))
                .body("[13].steps[0].price", is(139.25f))
                .body("[13].steps[1].origin", is("BEL"))
                .body("[13].steps[1].destiny", is("CGH"))
                .body("[13].steps[1].departure", is("2021-02-17T11:30:00"))
                .body("[13].steps[1].arrival", is("2021-02-17T23:30:00"))
                .body("[13].steps[1].company", is("iTrain"))
                .body("[13].steps[1].price", is(1094.5f))
                .statusCode(HttpStatus.OK.value());
    }

    @Test
    public void listing_ConnectionWithDate_ReturningFiltered2() {
        given()
                .queryParam("originStation", "BSB")
                .queryParam("destinyStation", "FLN")
                .queryParam("tripDate", "2021-02-10")
                .contentType(ContentType.JSON)
                .when()
                .get()
                .then()
                .body("size()", is(3))
                .body("$", everyItem(hasKey("origin")))
                .body("$", everyItem(hasKey("destiny")))
                .body("$", everyItem(hasKey("departure")))
                .body("$", everyItem(hasKey("arrival")))
                .body("$", everyItem(hasKey("steps")))
                .body("$.steps", everyItem(hasKey("origin")))
                .body("$.steps", everyItem(hasKey("destiny")))
                .body("$.steps", everyItem(hasKey("departure")))
                .body("$.steps", everyItem(hasKey("arrival")))
                .body("$.steps", everyItem(hasKey("company")))
                .body("$.steps", everyItem(hasKey("price")))
                .body("[0].origin", is("BSB"))
                .body("[0].destiny", is("FLN"))
                .body("[0].departure", is("2021-02-10T09:00:00"))
                .body("[0].arrival", is("2021-02-10T19:20:00"))
                .body("[0].steps[0].origin", is("BSB"))
                .body("[0].steps[0].destiny", is("FLN"))
                .body("[0].steps[0].departure", is("2021-02-10T09:00:00"))
                .body("[0].steps[0].arrival", is("2021-02-10T19:20:00"))
                .body("[0].steps[0].company", is("UberOnRails"))
                .body("[0].steps[0].price", is(1347.21f))
                .body("[1].origin", is("BSB"))
                .body("[1].destiny", is("FLN"))
                .body("[1].departure", is("2021-02-10T19:00:00"))
                .body("[1].arrival", is("2021-02-10T23:30:00"))
                .body("[1].steps[0].origin", is("BSB"))
                .body("[1].steps[0].destiny", is("FLN"))
                .body("[1].steps[0].departure", is("2021-02-10T19:00:00"))
                .body("[1].steps[0].arrival", is("2021-02-10T23:30:00"))
                .body("[1].steps[0].company", is("iTrain"))
                .body("[1].steps[0].price", is(369.19f))
                .body("[2].origin", is("BSB"))
                .body("[2].destiny", is("FLN"))
                .body("[2].departure", is("2021-02-10T06:40:00"))
                .body("[2].arrival", is("2021-02-11T16:20:00"))
                .body("[2].steps[0].origin", is("BSB"))
                .body("[2].steps[0].destiny", is("VCP"))
                .body("[2].steps[0].departure", is("2021-02-10T06:40:00"))
                .body("[2].steps[0].arrival", is("2021-02-10T19:40:00"))
                .body("[2].steps[0].company", is("UberOnRails"))
                .body("[2].steps[0].price", is(948.46f))
                .body("[2].steps[1].origin", is("VCP"))
                .body("[2].steps[1].destiny", is("FLN"))
                .body("[2].steps[1].departure", is("2021-02-11T07:40:00"))
                .body("[2].steps[1].arrival", is("2021-02-11T16:20:00"))
                .body("[2].steps[1].company", is("UberOnRails"))
                .body("[2].steps[1].price", is(1192.39f))
                .statusCode(HttpStatus.OK.value());
    }

}
